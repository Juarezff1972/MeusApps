
Program Merger;
const
    Tela : array[1..48] of string[79] =
('1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111');
    Tela2 : array[1..48] of string[79] =
('2222221111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111',
 '1111111111111111111111111111111111111111111111111111111111111111111111111111111');

type

         T_Reg = byte;
         T_Arq = File of T_Reg;

var ArqProg     : T_Arq;
    BufProg     : T_Reg;
    ArqTela     : text;
    BufTela     : char;
    NomeArqProg : string[80];
    NomeArqTela : string[80];
    ch          : char;
    i           : integer;
    NRel        : integer;
    Ok          : Boolean;
    Sequencia   : String[4];
    Inicio      : integer;
    Video       : array[1..4000] of byte absolute $b800:000;
Procedure Alteracao;
Const AJUSTE = 6;
var
  i,
  Ct   : integer;
begin
  i := 0;
  Ct := 0;
  Repeat
    while Ct <= AJUSTE  do
      begin
        Read(ArqTela,BufTela);
        Ct := Succ(Ct);
      end;
    Read(ArqTela,BufTela);
    GotoXY(30,18);
    Write('Gravado -> ',Ord(BufTela):3);
    mem[$b800:i] :=byte(BufTela);
    BufProg:=byte(BufTela);
    Seek(ArqProg,NRel);
    Write(ArqProg,BufProg);
    NRel := Succ(NRel);
    i:=Succ(i);
  until EOF(ArqTela);
end;
begin
     Move(Tela,Video,3840);
     repeat
     until keypressed;
     Move(Tela2,Video,3840);
     GotoXY(10,10);
     Write('Nome do Programa a ser modificado : ');
     Read (NomeArqProg);
     GotoXY(10,12);
     Write('Nome do Arquivo de Tela           : ');
     Read (NomeArqTela);
     GotoXY(10,14);
     Write('Sequencia inicial a buscar (4 car): ');
     Inicio := 10000;
     Read (Sequencia);
     Assign(ArqProg,NomeArqProg);
     Assign(ArqTela,NomeArqTela);
     Ok := false;
     (*$i- *) Reset (ArqProg);Reset(ArqTela); (*$i+ *)
     GotoXY(10,16);
     Write('byte Inicial ->');
     Read(Inicio);
     Seek(ArqProg,Inicio);
     if IoResult = 0 then
       Repeat
         Read(ArqProg,BufProg);
         GotoXY(40,16);
         Writeln('Posicao -> ',FilePos(ArqProg):5);
         GotoXY(10,18);
         Writeln('Lido -> ',Ord(BufProg):3);
         if BufProg = byte(sequencia[1]) then
           begin
             NRel:= FilePos(ArqProg)-2;
             Read(ArqProg,BufProg);
             if BufProg = byte(sequencia[2]) then
               begin
                 Read(ArqProg,BufProg);
                 if BufProg = byte(Sequencia[3]) then
                   begin
                     Read(ArqProg,BufProg);
                     if BufProg = byte(Sequencia[4]) then
                       begin
                         Alteracao;
                         Ok := true;
                       end;
                   end;
               end;
           end;
       until Ok ;
     GotoXY(20,23);
     Writeln(IoResult);
     Close(ArqProg);
     Close(ArqTela);
end.

