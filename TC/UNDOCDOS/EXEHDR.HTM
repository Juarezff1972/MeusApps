<HTML>
<HEAD>
<TITLE>The EXE header.   Source code included.</TITLE>
</HEAD>

<BODY link="blue" vlink="purple" background="bmain.gif">
<!-- *** a blank table to get text of the left margin in NETSCAPE -->
<table align=left border=0 width="100%">
<td width="4%"></td>
<td width="96%">

<p>
<H2>The EXE header</H2>

<p align=left><font color=black size=2 face="Comic Sans MS">
EXEHDR is an EXE header viewer<br>
Version:  1.00b<br>
Author:  Ben Lunt (Forever Young Software(R))<br>
Date:  10/05/97<br>
Assembler:  MASM 5.10<br>
<br>
Download the zip file from <a HREF="exehdr.zip">here</A>, or below, and
unzip it (<a href="ftp://ftp.pkware.com/pub/pkware/pkz204g.exe">PKUNZIP</a> 2.04g recommended) in a directory of your choice.<br>
<i>(To download, I suggest right clicking the link and saving to disk)</i><br>
<br>
<a HREF="exehdr.zip">EXEHDR.ZIP</A> (3,386) should contain 2 files:<br>
EXEHDR.ASM	 (9,998)<br>
EXEHDR.EXE	 (1,768)<br>
<i>If there are any differences in the package you got, please let me know.</i><br>
<br>
The assembly source code is included in the zip file for EXEHDR.EXE to show how an EXE files header is formmated.  (Also see below)<br>
<br><br>
This is part of the code included in EXEHDR.ASM.  It shows the header of an EXE<br>
<pre>
<font face="" size=2>
   HdrID     dw  00h     ; ID signature ('MZ') ******** EXE header *********
   excess    dw  00h     ; Image size mod 512 (bytes on last page)
   pages     dw  00h     ; # 512-byte pages in image
   reloct    dw  00h     ; count of relocation table entries
   hdrsize   dw  00h     ; size of header, in paragraphs
   minmem    dw  00h     ; min required mem
   maxmem    dw  00h     ; max required mem
   stacks    dw  00h     ; stack seg offset in load module
   stackp    dw  00h     ; initial value of sp
   cksum     dw  00h     ; file checksum
   ipointer  dw  00h     ; initial value of IP
   codes     dw  00h     ; cs offset in load module
   relostart dw  00h     ; offset of first reloc item
   ovlnum    dw  00h     ; overlay number
</font>
</pre>
<br>
If you notice, we don't need the whole page (512 bytes) of disk space this header takes up.  There is room for 121 4-byte relocation units after the overlay number word above.  If you don't use all of this room, why not modify the EXE file and header to get rid of this wasted space?<br>
<br>
If we change the <i>size</i> of the file at the dword at offset 02h, change the size of the header at offset 08h, and then rewrite the EXE file with out the wasted space, we can cut an EXE file by 484 bytes if there aren't any relocation entrys.<br>
<br>
The new size of the header would be: 
<pre><font size = 2>Size of header (512) - (actual header (28) - (4*relocation entrys))</font></pre>
<br>
I have a utility included with my NewBasic Beta package that will do this for you.  See SHRNKEXE.COM on my <a href="newbasic.htm">NewBasic</a> page.  Also see EXEHDR.EXE on the same page for a utility that will display this header.<br>
<br><br>
All rights reserved.<br>
<A HREF="legal.htm"><font size=1>Legal Notice</font></A><br>
<i>Copyright &copy; 1984-1999  Forever Young Software<BR></i>
<A HREF="index.htm"><IMG SRC="gohome.gif" ALT="Return to My Home Page" ALIGN=middle WIDTH=44 HEIGHT=39 border=0></A>
<a HREF="index.htm">Return to My Home Page</A>
</P>
</td>
</table>
</BODY>
</HTML>
